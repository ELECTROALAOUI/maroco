<div class="m13">
    <p class="warn">暂时不要使用table的editable接口，过于复杂，正在优化中...,下面是列冻结示例，实际上是用了两个table实例联合成的</p>
    <div class="row ellipsis">
        <div class="x" id="tableDemoLeft" style="margin-right: -1px;z-index: 5;position: relative;"></div>
        <div class="row" id="tableDemo"></div>
    </div>
</div>
<script>
seajs.use(['ui/table', 'ui/notify'], function(table, notify) {
    var tips=notify.tips;
    //mock table列表
    Mock.mock('fakedata_demo.json', {
        "total|200": 12,
        "data|20": [{
            'id|+1': 12,
            "cname": '@WORD',
            "address": "@TITLE",
            "thumb": '@IMAGE',
            "from": '@STRING(3,8)',
            "sender": '@NAME',
            "sendtime": '@DATE("yyyy-MM-dd")'
        }]
    });
    //mock 单条更新
    Mock.mock('fakedata_demo_update.json', {
        "data": {
            'id|+1': 12,
            "cname": '@WORD',
            "address": "@TITLE",
            "thumb": '@IMAGE',
            "from": '@STRING(3,8)',
            "sender": '@NAME',
            "sendtime": '@DATE("yyyy-MM-dd")'
        }
    });
    // 更多ctable配置接口详见 ui/table.js
    var leftTable = table({
        container: '#tableDemoLeft',
        //排序,参考jqueryui sortable
        sortable: {
            //当有变化的时候触发
            update: function(event, ui) {
                var tbody = ui.item.parent();
                var data = ctable.cache;
                var thisdata = data[ui.item.data('index')];
                tbody.find('tr').each(function(i, o) {
                    $(o).find('td:eq(2)').html(i+1);
                });
                notify.safe('成功更改排序');
            }
        },
        //列配置,title,width,sortable...
        cols: [{
            title: 'ID',
            align: 'center',
            width: 45
        }, {
            title: '冻结列',
            width: 120
        }],
        events: {
            'mouseenter tr': function(e, tr, data, config) {
                ctable.tbody.children().eq($(tr).index()).trigger('mouseenter',{silent:true});
            },
            'mouseleave tr': function(e, tr, data, config) {
                ctable.tbody.children().eq($(tr).index()).trigger('mouseleave',{silent:true});
            }
        },
        //没有render方法的时候，执行cols内部的html
        render: function(records) {
            //这边返回table矩阵[[01,02,03],[11,12,13]] 用于输出的内容
            return _.map(records, function(record, i) {
                return [
                    i + 1,
                    record.cname,
                    record.address,
                    record.sendtime,
                    '<a data-index="' + i + '" href="javascript:;" class="ac-getdata">查看</a>'
                ];
            });
        },
        //是否启用checkbox
        checkbox: true,
        count: 20,
        //自适应屏幕
        height: function(table) {
            return $(window).height() - table.offset().top;
        },
        //滚动同步
        onscroll: function(v, h) {
            if (v !== undefined) {
                ctable.contentEl.trigger('rollbar', [v, h, 1]);
            }
        },
        create: function() {
            this.contentEl = this.table.find('.rollbar-content');
            this.foot.find('.pager').hide();
            this.body.find('.rollbar-path-vertical').remove();
        }
    });
    var ctable = table({
        container: '#tableDemo',
        //列配置,title,width,sortable...
        cols: [{
            title: '人员',
            align: 'center',
            width: 120
        }, {
            title: '功能需求',
            width: 200,
            // colgroup: "组合",
            //需要排序
            order: 'cname',
            width: 120
        }, {
            title: ' 方法调用',
            width: 920
        }, {
            title: '交单时间',
            //需要排序k
            order: 'sendtime',
            width: 120
        }, {
            title: '操作',
            width: 520
        }],
        events: {
            'click .ac-getdata': function(event, tr, data, config) {
                console.log(data);
            },
            'mouseenter tr': function(e, tr, data, config) {
                leftTable.tbody.children().eq($(tr).index()).trigger('mouseenter',{silent:true});
            },
            'mouseleave tr': function(e, tr, data, config) {
                leftTable.tbody.children().eq($(tr).index()).trigger('mouseleave',{silent:true});
            }
        },
        //没有render方法的时候，执行cols内部的html
        render: function(records) {
            //这边返回table矩阵[[01,02,03],[11,12,13]] 用于输出的内容
            return _.map(records, function(record, i) {
                return [
                    i + 1,
                    record.cname,
                    record.address,
                    record.sendtime,
                    '<a data-index="' + i + '" href="javascript:;" class="ac-getdata">查看</a>'
                ];
            });
        },
        status: $.noop,
        //数据加载后执行
        afterLoad: function(data, cache) {
            leftTable.loader.afterLoad(data);
        },
        //自适应屏幕
        // height: 'window',
        //是否启用checkbox
        checkbox: false,
        height: function(table) {
            return $(window).height() - table.offset().top;
        },
        //滚动同步
        onscroll: function(v, h) {
            if (v !== undefined) {
                leftTable.contentEl.trigger('rollbar', [v, h, 1]);
            }
        },
        //每页数量
        count: 20,
        //加载路径
        url: 'fakedata_demo.json',
        //需要固定提交的参数
        baseparams: {
            token: 'FFASLE*&EFFA^%$#ef'
        },
        create: function() {
            this.contentEl = this.body.find('.rollbar-content');
        }
    });
    ctable.load();
});
</script>
