define("js/ui/picasa",["css/picasa.css","js/vendor/jquery.mousewheel"],function(t,i,e){t("css/picasa.css"),t("js/vendor/jquery.mousewheel");var a,s,c=6===UI.browser.ie,n={sideWidth:0,mask:!0,margin:[0,0,0,0],padding:[10,50,80,50],skin:"",thumb:!0,close:function(t,i){i=i||this,i.el.remove(),$(window).off("resize.picasa"),$("body").removeClass("pica-body")},escExit:!0,layout:function(){var t=this,i=$(window),e=t.padding,a=i.width()-t.margin[3]-t.margin[1]-t.sideWidth-e[1]-e[3],s=i.height()-t.margin[0]-t.margin[2]-e[0]-e[2];t.sceneMax={width:a,height:s,rate:a/s,x:a/2+e[3],y:s/2+e[0]},this.stage.css({top:t.margin[0],left:t.margin[3],right:t.margin[1]+t.sideWidth,bottom:t.margin[2]}),t.sideWidth&&this.sidebar.css({width:t.sideWidth,top:t.margin[0],right:t.margin[1],bottom:t.margin[2]}),c&&(this.stage.width(i.width()-t.margin[1]-t.margin[3]-t.sideWidth).height(i.height()-t.margin[0]-t.margin[2]),this.sidebar.height(i.height()-t.margin[0]-t.margin[2]));var n=t.data[t.active];n.src||t.scene.height(n.height=s).width(n.width=a)},load:function(t,i){2==t.readyState&&i();var e=new Image,a=this;t.readyState>0||(t.readyState=1,a.scene.empty().addClass("pica-loading"),e.onload=function(){t.readyState=2,t._width=this.width,t._height=this.height,t.rate=this.width/this.height;var e,s,c=a.sceneMax;c.rate>t.rate?(s=Math.min(t._height,c.height),e=s*t.rate):(e=Math.min(t._width,c.width),s=e/t.rate),_.extend(t,{width:e,height:s,scale:e/t._width,left:c.x-e/2,top:c.y-s/2}),a.scene.removeClass("pica-loading"),i()},e.onerror=function(){t.readyState=-1,a.scene.removeClass("pica-loading"),i()},e.src=t.src)},position:function(){var t=this.data[this.active];this.scene.css({width:t.width,height:t.height,left:t.left,top:t.top})},active:0,onchange:$.noop,setTitle:function(t,i){return'<span class="pica-page">'+t+"/"+this.data.length+"</span>"+(i.title||"")},prev:function(t,i){i=i||this,i.play(i.active-1)},next:function(t,i){i=i||this,i.play(i.active+1)},play:function(t){var i=this,e=this.data.length-1;if(!(0>t||t>e)){var a=this.data[t];this.prevBtn.toggle(0!==t),this.nextBtn.toggle(t!==e),this.rotater.toggle(!!a.src),this.active=t,this.thumbUl.css("marginLeft",-15-32*t),this.title.html(i.setTitle(t+1,a)||""),this.insert(t,a),this.onchange(a)}},rotate:function(t,i){i=i||this;var e=i.data[i.active];e.src&&(e.rotate=(e.rotate||0)+1,i.scene.children().get(0).style.cssText=i.rotateStyle(e))},rotateStyle:function(t,i){return i&&!t.rotate?"":void 0!=this.cssPrefix?this.cssPrefix+"transform:rotate("+90*t.rotate+"deg)":"filter:progid:DXImageTransform.Microsoft.BasicImage(rotation="+(t.rotate+4)%4+")"},insert:function(t,i){var e=this,s=e.sceneMax;i.src?(e.scene.draggable("enable"),e.load(i,function(){if(t==e.active){2==i.readyState&&(e.cssPrefix&&a&&(clearTimeout(a),e.scene.addClass("pica-tranfix")),e.position(),e.cssPrefix&&(a=setTimeout(function(){e.scene.removeClass("pica-tranfix")},300)));var s=e.rotateStyle(i,1);e.scene.html('<img src="'+i.src+'"'+(s?' style="'+s+'"':"")+' class="pica-player pica-img">')}})):(e.scene.draggable("disable"),_.extend(i,{width:s.width,height:s.height,left:e.padding[3],top:e.padding[0]}),i.iframe?e.scene.html('<iframe class="pica-player pica-frame scroll" src="'+i.iframe+'"></iframe>'):e.scene.html('<div class="pica-player pica-html scroll">'+(i.html||"")+"</div>"),e.position())},events:{"click .ac-pica-close":"close","click .ac-pica-prev":"prev","click .ac-pica-next":"next","click .pica-rotate":"rotate"},showTip:function(t){var i=this;s?clearTimeout(s):i.stip.stop().show().fadeIn(),s=setTimeout(function(){i.stip.fadeOut(),s=0},800),this.stip.html(t)},init:function(){var t=this;t.el.addClass("mask glass pica-body "+t.skin).html('<div class="pica-sidebar scroll am-fadeup"></div>                <div class="pica-stage  user-select am-fadeup">                    <div class="pica-scene"></div>                    <div class="pica-thumb"><ul></ul></div>                    <div class="pica-title"></div>                    <div class="pica-tool"><b class="f f-turnr f-2x pica-rotate"></b></div>                    <div class="pica-prev ac-pica-prev">&lt;</div>                    <div class="pica-next ac-pica-next">&gt;</div>                    <span class="pica-stip"></span>                </div>                <div class="pica-close ac-pica-close"></div>').appendTo($("body").addClass("pica-body")),t.escExit&&t.el.attr("tabIndex",1).keydown(function(i){27==i.keyCode&&t.close()}).focus();var i=t.el[0].style;t.cssPrefix=_.find(["-webkit-","-moz-","-ms-",""],function(t){return t+"transform"in i}),t.stip=t.$(".pica-stip"),t.closeBtn=t.$(".pica-close"),t.prevBtn=t.$(".pica-prev"),t.nextBtn=t.$(".pica-next"),t.rotater=t.$(".pica-rotate"),t.stage=t.$(".pica-stage").on("mousewheel",function(i,e,a,s){var c=t.data[t.active];if(c.src&&"scale"in c){i.preventDefault(),i.stopPropagation();var n=e>0?1.15:.85,r=parseInt(c.scale*n*100),o=t.sceneMax;if(1>r||r>1e4)return;$(i.target).hasClass("pica-player")||(i=o.x<c.left||o.y<c.top||o.x>c.left+c.width||o.y>c.top+c.height?{offsetX:c.left+c.width/2,offsetY:c.top+c.height/2}:{offsetX:o.x,offsetY:o.y}),c.scale*=n,c.width=c._width*c.scale,c.height=c._height*c.scale,c.left=i.offsetX-(i.offsetX-c.left)*n,c.top=i.offsetY-(i.offsetY-c.top)*n,t.showTip(r+"%"),t.position()}}),t.scene=t.$(".pica-scene").draggable({drag:function(i,e){var a=t.data[t.active];a.left=e.position.left,a.top=e.position.top}});var e=t.thumb;t.thumb=t.$(".pica-thumb"),t.thumbUl=t.thumb.find("ul"),e?(t.thumb.on("mousewheel",function(i,e,a,s){i.preventDefault(),i.stopPropagation(),0>e?t.next():t.prev()}),t.thumbUl.html(_.reduce(t.data,function(t,i,e){return t+'<li><img index="'+e+'" title="'+(i.title||"")+'" class="am-fadeup" src="'+i.thumb+'"></li>'},"")).on("click","img",function(){t.play(+this.getAttribute("index"))})):t.thumb.hide(),t.title=t.$(".pica-title"),t.tool=t.$(".pica-tool"),t.sidebar=t.$(".pica-sidebar"),t.sideWidth&&t.sidebar.show().width(t.sideWidth),t.layout(),t.play(t.active),$(window).on("resize.picasa",function(){t.layout()})}};return function(t){return UI(_.create(n,t))}});