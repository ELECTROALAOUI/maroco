define("js/ui/upload",["js/vendor/plupload/plupload.full.min.js","ui/notify"],function(e,i,l){e("js/vendor/plupload/plupload.full.min.js"),plupload.addI18n({"Stop Upload":"停止上传","Upload URL might be wrong or doesn't exist.":"上传的URL可能是错误的或不存在。",tb:"TB",Size:"大小",Close:"关闭","Init error.":"上传初始化错误，您的浏览器是否支持Flash？","Add files to the upload queue and click the start button.":"将文件添加到上传队列，然后点击”开始上传“按钮。",Filename:"文件名","Image format either wrong or not supported.":"图片格式错误或者不支持。",Status:"状态","HTTP Error.":"HTTP 错误。","Start Upload":"开始上传",mb:"MB",kb:"KB","Duplicate file error.":"重复文件错误。","File size error.":"文件体积太大。","N/A":"N/A",gb:"GB","Error: Invalid file extension:":"错误：无效的文件扩展名:","Select files":"选择文件","%s already present in the queue.":"%s 已经在当前队列里。","File: %s":"文件: %s",b:"B","Uploaded %d/%d files":"已上传 %d/%d 个文件","Upload element accepts only %d file(s) at a time. Extra files were stripped.":"每次只接受同时上传 %d 个文件，多余的文件将会被删除。","%d files queued":"%d 个文件加入到队列","File: %s, size: %d, max file size: %d":"文件: %s, 大小: %d, 最大文件大小: %d","Drag files here.":"把文件拖到这里。","Runtime ran out of available memory.":"运行时已消耗所有可用内存。","File count error.":"文件数量错误。","File extension error.":"文件类型错误。","Error: File too large:":"错误: 文件太大:","Add Files":"增加文件"});var o,t=e("ui/notify");return function(i){var l=new plupload.Uploader($.extend(!0,{runtimes:"html5,flash",max_file_size:"100mb",flash_swf_url:e.resolve("../")+"vendor/plupload/Moxie.swf",init:{PostInit:function(e){o=t({title:'文件上传 <span class="ac-num m4"></span>',cls:"link",draggable:!0,mask:!0,width:500,events:{"click .ac-cancel":function(i,l){$(this).parent().fadeOut(function(){l.el.position(l.position),$(this).remove()});file=e.getFile($(this).data("id")),file&&e.removeFile(file)}},close:function(e,i){i=i||this,i.contentEl.children(".ac-error").remove(),i.mask.hide()},add:function(e){o.mask.show(),$.each(e,function(e,i){i.dom=$('<div id="'+i.id+'" class="log" style="margin-bottom:-1px"><b class="f f-multiply am-rotate xr ac-cancel" data-id="'+i.id+'"></b><span class="xr m2">'+plupload.formatSize(i.size)+'</span><div class="ellipsis w12">'+i.name+'</div><div class="progress"><div class="note bar"></div></div></div>'),i.bar=i.dom.find(".bar"),o.contentEl.append(i.dom)}),this.el.position(this.position)},create:function(){this.queue=this.el.find(".ac-num")}}),o.close(),i.PostInit&&i.PostInit.call(this,e)},QueueChanged:function(e){var i=e.files.length;o.queue.html(i?"正在上传 "+i+" 个文件...":"")},FilesAdded:function(e,l){o.add(l),i.FilesAdded&&i.FilesAdded.call(this,e,l),e.start()},BeforeUpload:function(e,l){i.BeforeUpload&&i.BeforeUpload.call(this,e,l)},UploadProgress:function(e,i){i.bar.width(i.percent+"%")},FileUploaded:function(e,l,o){return o=JSON.parse(o.response),o.success?(l.dom.fadeOut(function(){$(this).remove()}).find(".ac-cancel").remove(),e.removeFile(l),void(i.FileUploaded&&i.FileUploaded(e,l,o))):void e.trigger("Error",{code:"sugon",message:o.msg,file:l})},UploadComplete:function(e,l){0==o.contentEl.children(".ac-error").length&&o.close(),i.UploadComplete&&i.UploadComplete(e,l)},Error:function(e,i){var l=i.file;l?(l.dom?e.removeFile(l):o.add([l]),l.bar.parent().replaceWith('<div class="c-error">'+(-600==i.code?"文件大小不能超过"+e.settings.filters.max_file_size:i.message)+"</div>"),l.dom.addClass("ac-error").find(".ac-cancel").remove()):t.error(i.message)}}},i));return l.init(),l}});