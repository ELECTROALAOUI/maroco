define("js/ui/grid",["ui/pager"],function(e,t,i){var s=e("ui/pager");return function(e){return UI($.extend(!0,{checkbox:!1,status:function(e,t,i){return"共 "+e+" 条数据"},parseData:function(e){return e.result},cache:null,onSelected:$.noop,afterLoad:$.noop,onOrderChange:$.noop,baseparams:{},events:{"mouseenter  .grid-row":function(){$(this).addClass("grid-hover")},"mouseleave  .grid-row":function(){$(this).removeClass("grid-hover")},"click  .grid-row":function(e,t){var i;if(!e.ctrlKey){var s=$(e.target);s.hasClass("grid-check")||s.parent().hasClass("grid-check")||(i=$(this).siblings(".grid-selected").removeClass("grid-selected").length>0)}$(this).toggleClass("grid-selected",i||void 0),t.isSelectAll(i?!1:void 0),t.onSelected(t.getSelected())},"mouseup  .grid-row":function(e,t){3==e.which&&($(this).hasClass("grid-selected")||($(this).addClass("grid-selected").siblings().removeClass("grid-selected"),t.onSelected(t.getSelected())),t.contextmenu&&t.contextmenu.render(e.pageX,e.pageY))},"click  .grid-check-all":function(e,t){var i=$(this).parent().toggleClass("grid-selected"),s=i.hasClass("grid-selected");t.body.children().toggleClass("grid-selected",s),t.onSelected(s?t.cache:[])},"click  .order":function(e,t){var i=$(this),s="asc";i.hasClass("desc")?i.removeClass("desc"):i.hasClass("asc")?(s="desc",i.addClass("desc")):i.addClass("asc"),i.siblings().removeClass("asc desc"),_.extend(t.baseparams,{order:i.attr("order"),asc:s}),t.onOrderChange(),t.load()}},resetOrder:function(e){var t,i=this.baseparams;i.order=e.order,"desc"===e.asc?(t="asc desc",i.asc="desc"):i.asc=t="asc",this.loader.page=1;var s=this.head.children(".order").removeClass("asc desc");s.filter("[order="+e.order+"]").addClass(t),this.load()},isSelectAll:function(e){void 0===e&&(e=0==this.body.children(":not(.grid-selected)").length),this.head.toggleClass("grid-selected",e)},isScrolling:function(){var e=this.body[0],t=e.offsetWidth-e.scrollWidth;return this.head.css("margin-right",t),t>0},getSelected:function(){var e=[],t=this.cache;return this.body.children(".grid-selected").each(function(){var i=this.getAttribute("index");t[i]&&e.push(t[i])}),e},getRowData:function(e){var t=$(e).closest(".grid-row").attr("index");return this.cache[t]},updateRow:function(e,t){var i=this,s=this.cache[e.attr("index")];$.isFunction(t)?t(s):$.isPlainObject(t)&&_.extend(s,t),i.data=i.render([s]),e.html($(i.templates.items(i)).html())},layout:function(){this.body.height((_.isFunction(this.height)?this.height(this.el):this.height)-this.head[0].offsetHeight-this.foot.height()),this.isScrolling()},templates:{head:_.dot('<div class="grid-head">                    {{?it.checkbox}}<div class="grid-col grid-check grid-check-all"><i></i></div>{{?}}                    {{~it.cols :col:i}}                    <div class="grid-col c{{=i}} {{=col.cls||""}} {{=col.order?"order":""}}"{{?col.order}} order="{{=col.order}}"{{?}}{{?col.style}} style="{{=col.style}}"{{?}}>{{=col.title||"&nbsp;"}}{{?col.order}} <i class="order-tip"></i>{{?}}</div>                    {{~}}                    </div>'),items:_.dot('{{~it.data :trdata:index}}                    <div class="grid-row{{?trdata.selected}} grid-selected{{?}}" index="{{=index}}">                    {{?it.checkbox}}<div class="grid-col grid-check"><i></i></div>{{?}}                    {{~it.cols :col:i}}                    <div class="grid-col c{{=i}} {{=col.cls||""}}" {{?col.style}}style="{{=col.style}}"{{?}}>{{=trdata[i]===undefined||trdata[i]===null?"":trdata[i]}}</div>                    {{~}}                    </div>                    {{~}}')},load:function(e,t){t&&_.extend(this.loader.baseparams,t===!0?e:t),this.loader.load(e)},init:function(){var e=this,t=_.uniqueId("grid");this.el.addClass("grid"),this.head=$(this.templates.head(this)),this.body=$('<div class="grid-body" id="'+t+'"></div>'),this.foot=$('<div class="grid-foot"><span class="grid-statu"></span><div class="pager"></div></div>'),this.statubar=this.foot.find(".grid-statu");var i=this.pager=s({el:this.foot.find(".pager"),onPageClick:function(e,t){d.page=t,d.load()}});this.count||i.el.hide();var d=this.loader=UI.loader({baseparams:e.baseparams,loadtip:e.loadtip,loadtype:e.loadtype,count:e.count,url:e.url,beforeLoad:e.beforeLoad,cache:e.ajaxCache,afterLoad:function(t){var s=e.cache=e.parseData(t)||[];if(0===s.length&&this.page>1)return this.page=this.page-1,void this.load();var o=e.data=e.render(s),a=0;e.autoSelect&&(_.each(s,function(t,i){e.autoSelect(t)&&(a++,o[i].selected=!0)}),e.autoSelect=null),e.body.html(e.templates.items(e)),e.count&&i.render(t.total,d.page,d.count),e.statubar.html(e.status(t.total,d.page,d.count)||""),e.isSelectAll(0!==a&&a===s.length),e.afterLoad(t,s),e.isScrolling()&&a&&e.body.children(".grid-selected").get(0).scrollIntoView(),e.onSelected(e.getSelected())}});if(this.el.empty().append(this.head).append(this.body).append(this.foot),e.height)if(this.body.addClass("scroll"),_.isFunction(e.height)){var o=function(){document.getElementById(t)?e.layout():$(window).off("resize",a)},a=_.throttle(o,100,{leading:!1});$(window).resize(a),o()}else this.layout();this.contextmenu&&(this.contextmenu=UI(_.defaults({el:$('<div class="dropdown am-fadeup grid-contextmenu">'),render:function(t,i){$(document).trigger("click.dropdown");var s="",d=this.data=e.getSelected();return _.each(this.menus,function(e,t){""===e?s+='<li class="devider"></li>':(!e.test||_.isFunction(e.test)&&e.test(d)===!0)&&(s+="<li><a"+(e.cls?' class="'+e.cls+'"':"")+' href="'+(_.isFunction(e.href)?e.href(d):e.href||"#")+'">'+e.label+"</a></li>")}),""===s?void this.hide():(this.el.html('<ul class="menu dropdown-menu">'+s+"</ul>").show().appendTo("body").position({at:"left+"+t+" top+"+i,my:"left top",collision:"flipfit",of:window}),void(this.show&&this.show()))},hide:function(){this.el.detach()},init:function(){this.el.on("hide",function(){$(this).detach()}).add(e.body).on("contextmenu",function(e){e.preventDefault()})}},this.contextmenu)));var l,c,n,r,h=$('<div class="grid-boxselector">'),g=function(e,t){return e.top<t.bottom&&e.bottom>t.top&&e.left<t.right&&e.right>t.left},u=$(document),f=function(t){if(c){t.preventDefault();var i=t.clientX-l.clientX,s=t.clientY-l.clientY;if(n){h.css({width:Math.abs(i),height:Math.abs(s),left:l.clientX+(i>0?0:i),top:l.clientY+(s>0?0:s)});var d=h[0].getBoundingClientRect();r.each(function(e,t){$(t).toggleClass("grid-selected",g(d,t.getBoundingClientRect()))})}else if(Math.abs(i)>10||Math.abs(s)>10){if(!e.cache.length)return;n=!0,h.appendTo("body"),r=e.body.children(),e.contextmenu&&e.contextmenu.hide()}}};this.body.on("mousedown",function(t){var i=t.offsetX,s=t.offsetY;if(!i&&!s){var d=this.getBoundingClientRect();i=t.pageX-d.left,s=t.pageY-d.top}1==t.which&&i<this.clientWidth&&s<this.clientHeight&&(l=t,c=!0,u.on("mousemove",f).one("mouseup",function(){if(c=l=null,n){r=n=null,h.detach();var t=e.getSelected();e.onSelected(t),e.isSelectAll(t.length===e.cache.length)}u.off("mousedown",f)}),t.target==this&&($(this).children().removeClass("grid-selected"),e.onSelected([]),e.isSelectAll(!1),e.contextmenu&&e.contextmenu.hide()))})}},e))}});